{% extends 'front/base.html.twig' %}

{% block javascript %}
  {{ parent() }}

  <script type="text/javascript">
let postTimeout;

$(document).ready(function () {
  $('.proposition').on('keyup', function () {
    let $this = $(this);
    let propositionText = $this.attr('proposition-text');

    clearTimeout(postTimeout);
    postTimeout = setTimeout(function () {
      $.ajax({
        type        : 'POST',
        url         : Routing.generate('api_study_test_proposition'),
        data        : { proposition: propositionText, exercise: $this.val() },
        dataType    : 'json',
        success     : function(data) {
          console.log(data);

          if (data.isOk) {
            $this.css('background-color', 'lightgreen');
          } else {
            $this.css('background-color', 'lightpink');

          }
        },
        error       : function(XMLHttpRequest, textStatus, errorThrown) {
          console.log(XMLHttpRequest);
            $this.css('background-color', 'lightpink');
        }
      });
    },
    500
      );
  });
});
  </script>
{% endblock javascript %}

{% block body %}
  <div class="container">

    <div class="container">
      {% for complaint in complaints %}
        <div class="box" style="margin: 10px">
          <div class="box-header">
            <h3 class="box-title"> {{ complaint.exercise.text }} </h3>
          </div> <!-- box-header -->
          <div class="box-body">
            <form action="{{ path('admin_complaint') }}"
                  method="POST"
                  >
                  <div class="row">
                    <div style='color: red' class="col-md-10" style="font-size: 12pt"> {{ complaint.propositionText }} </div> <!-- col -->
                    <div class="col-md-2">
                      <button type='submit' class='btn btn-primary'>
                        Ouki
                      </button>
                      <a href="{{ path('complaint_delete', {'complaint': complaint.id}) }}"
                         class='btn btn-danger'
                         >
                         Tropa
                      </a>
                    </div> <!-- col -->
                  </div> <!-- row -->
                  <div class="row">
                    {% for answer in complaint.exercise.answerList %}
                      <div class="col-md-12">
                        <input type='hidden' value='{{ complaint.id }}'
                           name='{{ complaint.exercise.text }}[_complaint]'
                           class='exercise-text'
                           >
                           <textarea rows="4" type='text'
                                     name='{{ complaint.exercise.text }}[{{ loop.index }}]'
                                     style='width: 100%; font-size: 13pt;'
                                     exercise-text='{{ complaint.exercise.text }}'
                                     proposition-text='{{ complaint.propositionText }}'
                                     class='form-control proposition'
                                     >{{ answer }}</textarea>
                      </div> <!-- col -->
                    {% endfor %}
                  </div> <!-- row -->
            </form>
          </div> <!-- box-body -->
        </div> <!-- box-body -->
      {% endfor %}
    </div> <!-- box -->
{% endblock body %}
